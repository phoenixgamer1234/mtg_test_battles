<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MTG Full Battle</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; margin:0; padding:0; }
  #game-container { display: flex; flex-direction: column; align-items: center; padding: 10px; }
  .zone { border: 1px solid #555; padding: 5px; margin: 5px; min-height: 100px; width: 90%; display: flex; flex-wrap: wrap; background: #333; }
  .card { width: 80px; margin: 2px; cursor: pointer; border: 1px solid #666; background: #111; }
  .card img { width: 100%; }
  #controls { margin: 10px; }
  button { margin: 2px; padding: 5px; }
</style>
</head>
<body>
<div id="game-container">
  <h1>MTG Battle Simulator</h1>

  <input type="file" id="deck-file" accept="application/json" />
  <button onclick="startGame()">Start Game</button>

  <div id="player-zones">
    <h2>Your Hand</h2>
    <div id="hand" class="zone"></div>
    <h2>Battlefield</h2>
    <div id="battlefield" class="zone"></div>
    <h2>Graveyard</h2>
    <div id="graveyard" class="zone"></div>
  </div>

  <div id="ai-zones">
    <h2>AI Battlefield</h2>
    <div id="ai-battlefield" class="zone"></div>
    <h2>AI Graveyard</h2>
    <div id="ai-graveyard" class="zone"></div>
  </div>

  <div id="controls">
    <button onclick="drawCard()">Draw Card</button>
    <button onclick="nextPhase()">Next Phase</button>
    <span id="phase-label">Phase: Start</span>
  </div>
</div>

<script>
let deck = [];
let hand = [];
let battlefield = [];
let graveyard = [];
let aiBattlefield = [];
let aiGraveyard = [];
let phase = 0;
let phases = ['Start', 'Draw', 'Main', 'Combat', 'End'];

function getCardImage(card) {
    if(card.image_uris && card.image_uris.small) return card.image_uris.small;
    if(card.card_faces && card.card_faces[0].image_uris) return card.card_faces[0].image_uris.small;
    return '';
}

function loadDeckFromFile(file) {
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const json = JSON.parse(e.target.result);
            deck = [];
            json.deck.forEach(c => {
                for(let i=0;i<c.count;i++) deck.push(c);
            });
            alert('Deck loaded: ' + deck.length + ' cards');
        } catch(err) {
            alert('Invalid JSON: ' + err);
        }
    };
    reader.readAsText(file);
}

document.getElementById('deck-file').addEventListener('change', e => loadDeckFromFile(e.target.files[0]));

function drawCard() {
    if(deck.length === 0) return alert('Deck empty');
    const card = deck.shift();
    hand.push(card);
    renderZones();
}

function playCard(index) {
    const card = hand.splice(index, 1)[0];
    battlefield.push(card);
    renderZones();
}

function renderZones() {
    const handDiv = document.getElementById('hand');
    const bfDiv = document.getElementById('battlefield');
    const graveDiv = document.getElementById('graveyard');
    const aiBfDiv = document.getElementById('ai-battlefield');
    const aiGrDiv = document.getElementById('ai-graveyard');

    handDiv.innerHTML = hand.map((c,i)=>`<div class="card" onclick="playCard(${i})"><img src='${getCardImage(c)}' /></div>`).join('');
    bfDiv.innerHTML = battlefield.map(c=>`<div class="card"><img src='${getCardImage(c)}' /></div>`).join('');
    graveDiv.innerHTML = graveyard.map(c=>`<div class="card"><img src='${getCardImage(c)}' /></div>`).join('');

    aiBfDiv.innerHTML = aiBattlefield.map(c=>`<div class="card"><img src='${getCardImage(c)}' /></div>`).join('');
    aiGrDiv.innerHTML = aiGraveyard.map(c=>`<div class="card"><img src='${getCardImage(c)}' /></div>`).join('');
}

function nextPhase() {
    phase = (phase + 1) % phases.length;
    document.getElementById('phase-label').innerText = 'Phase: ' + phases[phase];

    if(phases[phase] === 'Draw') drawCard();
    if(phases[phase] === 'Combat') aiAttack();
}

function startGame() {
    if(deck.length === 0) return alert('Load a deck first');
    for(let i=0;i<7;i++) drawCard();
    alert('Game started!');
}

function aiAttack() {
    if(aiBattlefield.length === 0) return;
    // AI deals 1 damage per creature to player hand as example
    if(hand.length>0) {
        const lostCard = hand.shift();
        graveyard.push(lostCard);
        alert('AI attacked! You lost a card.');
    }
    renderZones();
}
</script>
</body>
</html>

</body>
</html>
